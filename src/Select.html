<div class="selectContainer {isFocused ? 'focused' : ''}" on:click="handleClick()">
    {#if selectedItem}
    <div class="selectedItem">{selectedItem.name}</div>
    <div class="clearSelectedItem" on:click="handleClear()">
        <svg class="icon svelte-qw6fkp" width="100%" height="100%" viewBox="-2 -2 50 50" focusable="false"
             role="presentation">
            <path fill="currentColor"
                  d="M34.923,37.251L24,26.328L13.077,37.251L9.436,33.61l10.923-10.923L9.436,11.765l3.641-3.641L24,19.047L34.923,8.124 l3.641,3.641L27.641,22.688L38.564,33.61L34.923,37.251z"></path>
        </svg>
    </div>
    {:else}
    <input ref:input placeholder="Placeholder text">
    {/if}
</div>

<style>
    .selectContainer {
        border: 1px solid #D8DBDF;
        border-radius: 3px;
        height: 44px;
        position: relative;
    }

    .selectContainer input {
        border: none;
        color: #3F4F5F;
        height: 44px;
        line-height: 44px;
        padding: 0 16px;
        width: 100%;
        background: transparent;
        font-size: 14px;
        letter-spacing: -0.08px;
    }

    .selectContainer input::placeholder {
        color: #78848F;
    }

    .selectContainer input:focus {
        outline: none;
    }

    .selectContainer:hover {
        border-color: #b2b8bf;
    }

    .selectContainer.focused {
        border-color: #006FE8;
    }

    .selectedItem {
        padding: 0 16px;
        line-height: 44px;
    }

    .clearSelectedItem {
        position: absolute;
        right: 10px;
        top: 12px;
        width: 20px;
        height: 20px;
        color: #c5cacf;
    }

    .clearSelectedItem:hover {
        color: #2c3e50;
    }
</style>

<script>
  import List from './List.html';

  let list;
  let target;

  export default {
    onstate({changed, current, previous}) {
      if (!previous) return;

      if (changed.isFocused) {
        const {isFocused} = current;
        if (isFocused) {
          this.refs.input.focus();
          this.loadList();
        }
      }
    },
    methods: {
      handleClick() {
        this.set({isFocused: true});
      },
      handleClear() {
        this.set({selectedItem: undefined});
        this.refs.input.focus();
      },
      loadList() {
        if (target && list) return;

        target = document.createElement('div');

        Object.assign(target.style, {
          position: 'absolute',
          width: '400px'
        });


        document.body.appendChild(target);
        list = new List({
          target
        });

        const {items} = this.get();

        if (items) {
          list.set({items});
        }
        
        list.on('itemSelected', (selectedItem) => {
          this.set({
            selectedItem
          });
        })
      }
    },
    ondestroy() {
      if (!list) return;
      list.destroy();
      list = undefined;

      if (!target) return;
      target.remove();
      target = undefined;
    }
  }
</script>